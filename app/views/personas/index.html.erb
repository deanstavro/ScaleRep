<div id="title" class="jumbotron">
  <div class = "container">
    <br/>
    <h1><%= @user.client_company.name if @user.client_company %> Personas </h1>
    <div class="container">
      <%= link_to '+ Add Persona', new_persona_path, :class=>"add_campaign btn btn-primary btn-xl page-scroll" %>
    </div>
  </div>
</div>

<center>
  <p id="error" class="container text-danger"><%= flash[:error] %></p>
  <p id="notice" class="container text-warning"><%= flash[:notice] %></p>
</center>

<div class="table-display clickable-row">

  <table class="table table-hover">
    <thead class="thead-dark">
      <tr>
        <th scope="col">Persona</th>
        <th scope="col">People</th>
        <th scope="col">Delivered</th>
        <th scope="col">Bounces</th>
        <th scope="col">Replies</th>
        <th scope="col">Opens</th>
        <th scope="col">Number of Campaigns</th>
        <th scope="col">Show Campaigns </th>
        <th scope="col">Edit </th>
        <th scope="col">Delete Persona</th>
      </tr>
    </thead>
    <tbody>
      <% @personas.each do |persona| %>
        <tr>
          <td><%= persona.name %></td>

          <%  if @metrics_hash[persona] && @metrics_hash[persona][0] %>
             <td><%= @metrics_hash[persona][0] %></td>
          <% else %>
              <td>N/A</td>
          <% end %>

          <%  if @metrics_hash[persona] && @metrics_hash[persona][1] %>
             <td><%= @metrics_hash[persona][1] %></td>
          <% else %>
              <td>N/A</td>
          <% end %>

          <%  if @metrics_hash[persona] && @metrics_hash[persona][2] %>
             <td><%= @metrics_hash[persona][2] %></td>
          <% else %>
              <td>N/A</td>
          <% end %>

          <%  if @metrics_hash[persona] && @metrics_hash[persona][3] %>

                <%  if @metrics_hash[persona][0].to_i > @metrics_hash[persona][1].to_i  %>
                  <td><%= @metrics_hash[persona][3] %><br><%= reply_rate_calculator(@metrics_hash[persona][3], @metrics_hash[persona][1]) %>%</td>

                <% else %>

                  <td><%= @metrics_hash[persona][3] %><br><%= reply_rate_calculator(@metrics_hash[persona][3], @metrics_hash[persona][0]) %>%</td>

                <% end %>
          <% else %>
              <td>N/A</td>
          <% end %>

          <%  if @metrics_hash[persona] && @metrics_hash[persona][4] %>
             <td><%= @metrics_hash[persona][4] %><br><%= reply_rate_calculator(@metrics_hash[persona][4], @metrics_hash[persona][1]) %>%</td>
          <% else %>
              <td>N/A</td>
          <% end %>

          <%  if @metrics_hash[persona] && @metrics_hash[persona][5] %>
             <td><%= @metrics_hash[persona][5] %></td>
          <% else %>
              <td>0</td>
          <% end %>

          <td><%= link_to 'Show Campaigns', persona_path(persona) %></td>
          <td><%= link_to 'Edit', edit_persona_path(persona) %></td>
          <td><%= link_to 'Destroy',  persona,  method: :delete, data: { confirm: 'Are you sure?' } %></td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<script>
$("tr[data-link]").click(function() {
  window.location = $(this).data("link")
})
</script>
